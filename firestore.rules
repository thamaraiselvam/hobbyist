rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Feedback collection - write-only, no read access
    match /feedback/{feedbackId} {
      // Allow anyone to create feedback
      allow create: if request.resource.data.keys().hasAll(['feedback', 'timestamp'])
                    && request.resource.data.feedback is string
                    && request.resource.data.feedback.size() > 0
                    && request.resource.data.feedback.size() <= 500
                    && (
                      !request.resource.data.keys().hasAny(['email']) 
                      || request.resource.data.email == null
                      || (request.resource.data.email is string && request.resource.data.email.size() <= 100)
                    );
      
      // No read access for clients
      allow read: if false;
      
      // No update or delete access
      allow update, delete: if false;
    }
    
    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
